Preliminary Study on Monitoring System for the Demonstration Area of Artificial Upwelling Zhenyu Xu, Canbo Xiao, Feng Xu, Wei Fan  Institute of ocean engineering and technology Ocean College, Zhejiang University Zhoushan, China 21634109@zju.edu.cn Hong Pan* Hangzhou Radiant Digital Technology Co., LTD Hangzhou, China hong.pan@hzrad.comAbstract In  order  to  investigate  the  long-term  effects  of artificial  upwelling  on the  marine  environment,  Xiamen University,  Zhejiang  University,  China  Ocean  University  and other  units  have artificial  upwelling demonstration  area  in  Aoshan  Bay,  Qingdao  City,  China  in September 2017. The main purpose of this paper is to develop a data  acquisition  and  remote  monitoring  system  that  is  enough robust  to  realize  the  large-scale,  long-term,  real-time  and  long-range  monitoring  needs  of  the  demonstration  area.  The monitoring  system,  which  is  based  on  CAN-bus  technology, wireless transmission technology and Amazon Web Service, has been  initially  completed  and  tested.  The  system  can  realize remote  real-time  acquisition  of  sensor  data  and  video  signal, which  provide  a  solid  foundation  for  long-term  monitoring  of upwelling environmental effects in the demonstration area.    Keywordsartificial  upwelling,  monitoring  system,  CAN-bus, Amazon Web Service  I. INTRODUCTION Artificial upwelling, as a geoengineering tool, can bring up nutrient-rich  deep  seawater  to  euphotic  layer,  enhance  ocean primary  productivity,  promote  fish  reproduction,  and is expected  to  increase  ocean  carbon  sinks[1-3].  In  past  few centuries,  various  artificial  upwelling  systems  have  been developed, which are classified in different induced principles as  electrical  pump,  perpetual  salt  fountain,  wave  powered pump  and  air-lift  pump[4-7].  The  air-lift  pump,  which  is adopted in the demonstration area, has been well-known since the  end  of  18th  century.  Compared  with  other  upwelling inducing  methods,  air-lift  pump  is  simpler  in  principle,  more mature  in  technology  and  more  significant  in  effect.  The principle of air-lift pump is very simple. Air is compressed and injected  into  the  deep  water  through  a  nozzle,  then  bubbles ascend and the water will rise due to the density decrease of the air-water  mixture.  Liang  and  Peng  presented  theoretical analysis  and  experiments  to obtain  air-lift artificial  upwelling flow  characteristics  in  2005,  and  Fan  et  al.  from  Zhejiang University  performed  field  experiments  with the  air-lift pumping  system the  ThousandIsland  Lake,  Zhejiang Province,  China[6-7].  The  theoretical  and  experiment  results provides  a  basis  for  the  design  and  construction  of  the upwelling system in the demonstration area. The  artificial  upwelling  demonstration  area  is  located  in AoShan Bay. The map of the area is shown in Fig.1.AoShan Bay is the central and western part of the Yellow Sea. The BayÅfs shape is like the character "C", whose mouth faces  south.  The  bay  mouth  is  about  12km  long,  9km  wide from  north  to  south,  and  the  area  is  about  164km2[8].  The average depth of the bay is about 4m, the maximum is 13m and the  length  of  the  shoreline  is  about  65km.  The  two  main reasons  for  choosing  AoShan  Bay  as  the  demonstration  area are listed below: 1)  In  order  to  verify  the  effect  of  artificial  upwelling  on increasing  blue  carbon  sink,  a  comparative  experiment  was presented  by  planting  kelp  in  the  sea  area.  The  sea  area  of AoShan Bay is near inland with relatively shallow water depth and suitable temperature condition for kelp culture. 2)  The  sea  area  is  a  semi  closed  Bay  with  basically  no runoff from the outer sea. The nutrient structure of the bay is less  affected  by  the  external  environment,  so  it  is  easy  to measure the  effect  of  artificial  upwelling  on  nutrient concentration after the experiment. The demonstration area has an upwelling array that consists of 16 air-lift artificial upwelling devices, which are powered by a solar offshore platform with a height of 16m and a diameter of 26m. The solar offshore platform and upwelling devices  are shown in Fig.2. A 3mÅ~3mÅ~3m cabin was built in the center of the platform  for equipment  storage. The average  flow  rate of artificial  upwelling  is  estimated  to  be  20,000m3/day,  and  the affected area is expected to more than 30 hectares.  A total of 10 solar power supply modules were installed on the  platform.  Each  module  consists  of  an  25m2  solar  panel, four 1500Ah accumulators and a 220V AC output inverter. The total  daily  power  generation  can  reach  100kwh,  which  can meet  the  basic  requirements  of  the  platform  control  system, monitoring system and air injection compressors.  There are many  ways to monitor the environmental effect of artificial upwelling. Traditional method is manual sampling, in  which  scientists  periodically  collect  data  in  the  upwelling area,  and  then  sending  it  to  the  laboratory  for  analysis  and processing.  Satellite  remote  sensing  can  be  used  to  monitor large-scale  natural  upwelling.  The  advantages  of  remote sensing  is  wide  monitoring  range,  all-weather  acceptable  and continuous  quantitative  monitoring.  However,  long  repetitive observation  period  and low spatial resolution make it unsuitable  for  artificial  upwelling  monitoring.  A  set  of  buoy observation  system  was  proposed  for  the  "Tuohai"  artificial upwelling  equipment  in  Japan.  The  system  is  mainly  used  to monitor the variation of temperature and salinity with distance. In  the  air-lift  artificial  upwelling  experiment  carried  out  by Zhejiang University, relevant monitoring sensors were installed at fixed point. Although the real-time monitoring is guaranteed, each  sensor  needs  a  signal  cable  to  transmit  the  data  to  the monitoring  room.  On  the  one  hand,  the  underwater  cable  is very expensive, on the other hand, the increase in the number of  cables  reduces  the  reliability  and  stability  of  the  whole system. The  monitoring upwelling demonstration  area  should  meet  the  following  requirements. First,  Long-term  and  in-situ  monitoring.  The  increase  of primary productivity generated by artificial upwelling is a slow process,  which  takes  at  least  one  year  that  covers  the  kelp culture cycle. Second, real-time monitoring. In order to obtain the best upwelling effect, it is necessary to change the working state  of  the  air  injection  compressors  according  to  the parameters of illumination, ocean current velocity, the battery remaining  capacity  and  so  on.  Third,  wide  range  monitoring. The kelp culture area is about 6 hectares, half of which is under the  influence  of  upwelling.  The  monitoring  system  needs  to cover the space. II.  MONITORING SYSTEM ARCHITECTURE The monitoring system, as shown in Fig. 3, can be divided into  four  parts,  which  are  master  controller,  data  acquisition module, wireless communication module, and data storage and display module respectively. A.  The Master Controller The  master  controller  of  the  system  is  Raspberry  Pi  3 Model B+, which is a minicomputer developed by the British Raspberry  Pi  Foundation.  The  Raspberry  Pi,  with  operation frequency of 1.2GHz and running memory of 1GB, is equipped with  a  BCM2837  processor  based  on  the  ARM  Cortex-A53 kernel, four USB 2.0 interfaces, a Micro SD card interface, and a 10/100 Ethernet interface. The minicomputer supports WiFi and  Bluetooth  functions,  and  can  run  a  complete  operating system. The Raspberry Pi has the advantages of strong stability and low energy consumption, which is suitable for use in the offshore  platform.  The  master  controller  loaded  most  of  the monitoring  and  communication  procedures  written  in Python. The  controller restarts automatically  every  morning  to ensure its normal operation for long-term. The program automatically records  the  running  log,  and  if  there  occurs  an  error,  it automatically  sends  an  alarm  message  to  a  special  email address. B.  The Data Acquisition Module The  function  of  the  data  acquisition  module  of  the monitoring system is acquiring the sensor data and uploading it to the master controller. The main parameters to be measured in  the  artificial  upwelling  demonstration  area  include  pH, salinity,  temperature,  depth,  dissolved  oxygen  concentration, chlorophyll,  nutrients  concentration and  so  on. The  system  is initially  compatible  with  four  underwater  sensors  which  are EXO2  multi-parameter  water  quality  monitor,  SBE37-SM MicroCat  CTD,  AMT-O2-Micro-sensor  and  AMT-pH-sensor respectively, which are shown in Fig. 4. YSI EXO2 is an advanced water quality detector of 72cm length,  no  more  than  8cm  diameter  and  3kg  weight.  The maximum  working  depth  of  the  detector  is  250  meters,  and both  the  built-in  battery  and  external  cable  for  power  supply are  supported.  SBE37-SM  MicroCat  CTD  can  measure temperature,  conductivity,  depth  and  dissolved  oxygen concentration  with  high  accuracy.  The  maximum  working depth  of  the  sensor  is  100  meters.  The  plastic  shells  of  the sensor will not be corroded by seawater, so it can be put in the ocean environment for a long time. AMT-O2-micro-sensor is a shallow  water  dissolved  oxygen  sensor  produced  by  AMT Company. The sensor has a very short response time, including a  replaceable  sensor  probe  and  a  converter  integrated  circuit that converts current signals into 0-5V voltage signals. AMT-pH-sensor  is  a  shallow-water  pH  sensor  produced  by  AMT Company. It is mainly used for in-situ determination of natural waters such as oceans and lakes. The range of the measured pH value is 0 to 14, and the output signal is 0 to 5V voltage signal. The monitoring system decides to use CAN-bus technology to  transmit  sensor  data.  Each  node  connects  one  or  more sensors.  Sensor  nodes  use  a  control  board  with  STM32F-103VET6  as  the  core  to  read  data.  Because  the  output interfaces  of  different  sensors  are  different,  the  hardware peripherals of the control board may be different. The data read by slave nodes is sent to the major node through CAN-bus, and then  the  data  is  transmitted  to  the  master  controller  through RS232 to USB interface for further processing. The  CAN-bus  technology  is  very  suitable  for  the  data monitoring  system  in  the  demonstration  area  because  of  its practicality,  flexibility  and  strong  reliability.  The  CAN-bus communication only needs two lines, which greatly reduces the number  of  communication  cables.  The  CAN-bus  has  a  long transmission distance. When the transmission rate of CAN-bus is less than 5Kb/s, the transmission distance can reach 10km, which is enough to cover the artificial upwelling demonstration area. The CAN-bus can mount more than 100 nodes, which is enough  for  subsequent  nodes  expansion  of  the  monitoring system. When two or more sensor nodes send data at the same time, access conflicts of the CAN-bus occur. At this time, the bus will judge the priority of identifier ID. Sensor nodes with high priority continue to send data, while the nodes with low priority  actively  quit  sending  data  and  wait  for  the  bus  to become  idle.  This  solution  saves  the  processing  time  of  bus conflicts and avoids the phenomenon of network crash caused by excessive sensor nodes load. The control board circuit of the master and slave nodes of the system is mainly divided into the minimal system module with  the  main  controller  STM32F103VET6  as  the  core,  the CAN-bus  communication  module  with the  CAN-bus transceiver  CTM1051KT  as  the  core,  the  RS232  serial communication module with the MAX3232 as the core and the auxiliary  module  that  provides  crystal  oscillator,  reset  and power  supply. The diagram  of  the circuit  system  is  shown  in Fig. 5. The main controller STM32F103VET6 is ARM's enhanced controller  using  a  high-performance  Corex-M3  32-bit  RISC core. The operating frequency of the controller is 72MHz. The controller  has  built-in  512K  bytes  of  flash  memory  and  64K bytes  of  SRAM.  It  also  has  rich  enhanced  I/O  ports  and peripherals  connected  to  two  APB  buses.  The  temperature range  of  STM32F103VET6  is  from  -40  to  105 (cid:263),  and  the power supply voltage is 2.0 to 3.6V. The controller has built-in nested interrupt controller which can handle up to 60 interrupt channels.  The  5  USART  interfaces  provide  asynchronous communication, of which the UART1 interface  can communicate at a rate of 4.5 Mbit/sec and the other interfaces can  communicate  at  a  rate  of  2.25  Mbit/sec.  The  CAN-bus interface is compatible with specification 2.0A and 2.0B, and the communicate bit rate is up to 1 Mbit/sec. The  serial  communication  module  uses  MAX3232 communication  chip  to  convert  the  logic  signal  of  the controller into RS232 level signal. The module circuit diagram is shown in Fig. 6. Compared with MAX232, MAX3232 has the  advantage  of  low  power  consumption.  When  the  supply voltage is 3.3V, the power consumption current is only 0.3mA. In the slave node, the serial communication module is used to collect sensor data, while in the master node, it is used to send the aggregated data to the master controller, i.e. Raspberry Pi. The  CAN-bus  communication  module  is  based  on  the CTM1051KT  high-speed  CAN isolated transceiver  of Guangzhou  Zhiyuan  Electronics  Co.,  Ltd.  The  schematic diagram  is  shown  in  Fig.  7.  The  CAN-bus  transceiver  is  the bridge  connecting  CAN  controller  and  physical  bus,  and converts  the  logic  level  signal  and  bus  differential  signal  of CAN  controller.  The  CAN  transceiver  can  increase  the communication  distance  and  improve  the  anti-interference capability of the bus.  The control board is powered by 5V DC power supply. The rated voltage of the CAN-bus transceiver is 5V, while the rated voltage  of  the  main  controller  and  serial  communication module is 3.3V. Therefore, the voltage of 5V DC is converted to  3.3V  DC  by  using  ASM1117-3.3  low  voltage  differential linear regulator. The schematic diagram of ASM1117 is shown in Fig. 8. ASM1117 is a three-terminal linear voltage regulator circuit with low voltage difference. It has perfect protections of over-current and over-heat. According to the chip manual, the working circuit uses 10 uF capacitor in the input bypass and 22 uF capacitor at the output to improve the stability of the circuit. Because  the  working  voltage  of  AMT-O2-micro-sensor  and AMT-pH-sensor  is  12  V  DC,  the  power  boost  module  is adopted. In this paper,  XL6009  is  chosen  as  the  core  chip  of the  boost  module.  The  chip  has  a  built-in  4A  high-efficiency MOSFET  switching  tube  with  a  switching  frequency  of  400 KHz. Fig. 9 is the schematic diagram. The  program  of  the  data  acquisition  module  runs  on  the master  and  slave  nodes.  It  consists  of  sensor  data  reading, CAN-bus  configuration  and  CAN-bus  data  sending.  The program flow of reading sensor data is as follows: 1)  Configure  serial  port  parameters.  If  SBE37-SM MicroCat CTD sensor is used, the baudrate is set to 9600, the data bits 8, and the stop bits 1 with no check bits. 2)  Send  data  reading  commands  to  the  sensor.  If  the program  detects  the  serial  port  flag  bit  to  be  the  state  of completion,  the  sending  process  will  be  determined  to  be completed. 3) Receive the sensor data. If the receiving data register is not empty, the data will be transferred to the receiving buffer. 4) Set the global variable ÅgDataGetÅh to 1, which indicates the completion of data reception.  After the slave node reads the sensor data, it needs to send the data to the master node through the CAN-bus. The sending program flow is as follows: 1)  CAN-bus  configuration,  which  includes  opening  GPIO clock  and  CAN-bus  peripheral  clock,  and  configuring  CAN-bus  multiplexing  pin  mode,  that  is,  calling  corresponding function to map CAN-bus TX and RX signal to PB8 and PB9 pin. 2) Judge  whether  the  sensor reading  is  completed.  And if completed, enter the CAN-bus transmission program.  3) When the CAN-bus transmission program is completed, set the global variable ÅgDataGetÅh to 0. The CAN-bus filter and interrupt configurations are added to the master node. The bus filtering mode is set to shield bit mode. The message is received as long as the mask bit of the message  ID  is  same  with  the  corresponding  mask  bit  in  the identifier list.  When  new  message  comes  or  message overflows,  the  interrupt  program  will  response,  and  the interrupt service function will receive the message. C.  The Wireless Communication Module The wireless communication module of the system adopts 4G  network,  and  the  hardware  is  based  on  Huawei's  E8372 wireless  network  card  using  China  Unicom's  4G  network signal.  The  network  card  can  connect  directly  with  the Raspberry Pi through USB interface. The download and upload network  speeds  can  reach  1800  kb/s  and  2500  kb/s respectively,  which  are  enough  to  meet  the  data  transmission requirements of monitoring system. The  system  uses  MQTT(Message  Queuing  Telemetry Transport) protocol to achieve remote two-way communication with  users.  The  MQTT  protocol  is  a  lightweight  and  instant messaging  protocol  based  on  TCP/IP,  which  has  gradually become the main communication protocol instead of HTTP in the Internet of Things[9].  The implementation of MQTT protocol requires client and server side. The client is a device or application that uses the MQTT protocol and can establish a network connection to the server.  Clients  can  be  divided  into  message  publishers  and subscribers.  Publishers  first  establish  a  connection  with  the server  and  then  publish  the  message  to  the  server.  When subscribers  need  relevant  information,  they  first  establish  a connection with the server and then subscribe to the required information. The server, also known as a message broker, can be  an  application  or  a  device  that  bridges  publishers  and subscribers. In the monitoring system, the server and client side use Mosquitto and Paho-Mqtt software respectively to realize MQTT protocol. D.  The Data Storage and Display Module The aggregation and display of sensors and video data are implemented through AWS(Amazon Web Service). The AWS provides users with a set of cloud computing services including flexible  computing,  storage, database, Internet of Things,  and its  key  access  and  automatic  backup  functions  ensure  the security of data. The  server  on  the  cloud  platform  uses  Amazon  EC2 (Amazon Elastic Compute Cloud), which is a web service that provides  scalable  computing  capacity.  The  system  currently runs  two  virtual  machines, one of  which  serves  as an MQTT proxy  server  and  another  is  mainly  responsible  for  receiving video  streaming  data.  The  former  virtual  machine  configures two CPUs with a main frequency of 2.3Ghz and a memory of 4GB, and the latter configures one CPU with a main frequency of 2.3Ghz and a memory of 2GB. The operating systems of the virtual  machines  are  Linux  and  Ubuntu  respectively.  The storage  capacity  of  both  virtual  machines  can  be  expanded automatically  according  to  userÅfs  demand,  and  both  of  them map private IP addresses to fixed IP addresses. All  sensor  data  will  be  transferred  to  the  DynamoDB database after being pushed to the server. DynamoDB is a fast and fully hosted NoSQL database service, which automatically allocates resources to meet usersÅfrequirements forperformance.  DynamoDB  can  automatically  and syn-chronously replicate user data to multiple available servers. It uses a reliable key method, which only allows authorized users to access data. All video streaming data are converted to streaming media through  FFmpeg,  and  then  accepted  by  Wowza  services running  in  the  cloud  platform.  FFmpeg  is  an  open  source computer program that can record digital audio and video, and convert them into streams. FFmpeg contains a very advanced audio/video  codec  library.  Its  code  instructions  are  very efficient.  Wowza  is  a  commercial  streaming  media  server software product based on Java, which can realize the real-time push and transfer of video streams. All data and videos are displayed through the website. The website is mounted on the S3(Simple Storage Service) bucket of  AWS.  Amazon  S3  is  an  internet-oriented  storage  service that  allows  users  to  store  and  retrieve  data  of  any  size  and anywhere on the Web. The website imported Baidu map API, so  GPS  location  will  be  displayed  in  the  map  corresponding position. Baidu Map API is a set of free application interface based on Baidu Map Service written by JavaScript language. It can help users to construct rich and interactive map application in the website conveniently and quickly. At present, the back-end of the website has been basically completed, and the front-end interface is still in the process of optimization III.  SYSTEM INTEGRATION AND TESTING The  preliminary  integration  and  testing  of  the  monitoring system  are  completed  in  the  laboratory.  The  system  adopts  a four-core  submarine  cable,  in  which  two  cores  are  used  as CAN-bus transmission lines, and others are used as power lines for  all  underwater  sensors.  The  slave  node  of  the  system  is placed in a watertight acrylic cylindrical cabin, and the major node and Raspberry Pi are placed in an acrylic protective box. Fig.10 is the slave node in the watertight cabin. In the lab test, the sensor network is made up of three slave nodes and one major node. Three SBE37-SM MicroCat CTD sensors are selected to complete the test. In the test experiment, the environment of the three sampling nodes was set differently to compare with each other. Node 1: adding hot water to make the  water  temperature  higher  than  room  temperature.  Node two:  the  water  temperature  is  room  temperature,  but  adding 50g  salt  into  the  water  to  change  its  electrical  conductivity. Node 3: the water temperature is room temperature, but adding 100g  salt  into  the  water  to  change  its  electrical  conductivity, and injecting gas continuously to change its dissolved oxygen concentration. The results show that the master controller, data acquisition module, wireless communication module, and data storage and display module all work well. Real-time data and video can be acquired through the website.  At  present,  the  monitoring  system  has  been  preliminarily deployed  on  the  offshore  platform.  The  system  is  equipped with  two  sets  of  Raspberry  Pi,  whose  4G  networks  are independent  of  each  other.  The  system  is  currently  equipped with a GPS receiver, an onshore IP camera, an underwater IP camera  and  a  Raspberry  Pi  dedicated  miniature  camera.  The system  is  also  equipped  with  two  temperature  and  humidity sensors(one  in  the  cabin  and  another  near  the  sea  level),  one noise  sensor  and  several  underwater  sensor  interfaces,  which can be used at any time according to the needs. All inverters are connected to Raspberry Pi through a special connection line to monitor the operation of solar panels and batteries.  The  GPS  receiver  is  the  BU-354S4  receiver  of  Taiwan Huantian  Company.  The receiver  uses  SIRF4  high-performance GPS chipset, in which the ceramic antenna is built to  make  the  positioning  more  accurate.  The  temperature  and humidity  sensors and  noise  sensors are  all produced by  well-known sensor manufacturers in China. The size of temperature and humidity sensor is 45mm(cid:104)65mm(cid:104)28mm. The measuring ranges  are  -20~70 (cid:263)   and  0~100%RH.  The  measuring precisions are 0.5(cid:263) for temperature and 0.3% for RH. The size of  noise  sensor is  110mmÅ~85mmÅ~44mm.  It  is equipped  with louver  with  rain  proof  function.  The  measuring  range  is  30~ 120dB, and the measuring precision is Å}1.5dB. All two sensors use  RS485 interface to communicate and follow the MODBUS-RTU  protocol.  Fig.11  is  the  measured  outside temperature and humidity data in April 4th, 2018. The onshore IP camera has a high definition of 1080P with infrared  function.  Its  main  function  is  to  monitor  the  solar panel displayed on the platform. The underwater IP camera is developed  by  CCDCAM  Technology  Company from Shenzhen,  China. The camera  has  a  high-definition  of 1080P and support POE power supply. The maximum working depth is  about  100m.  The  camera  can  be  used  to  observe  the  fish school.  The  Raspberry  Pi  micro  camera  was  installed  in  the central  control  box.  Its  main  function  is  to  monitor  the indicator  light  to  judge  the  status  of  the  corresponding  relay. Fig.12 are the three cameras. Fig.13 is the photo of the onshore IP camera in evening.  The YSI EXO2 water quality detector was used to examine the system working condition in April 22nd, 2018. The result shows  that  the  monitoring  system  works  well.  The  dissolved oxygen  and  salinity  data  of  the  water  near  the  platform  are shown in Fig.14. IV.  CONCLUSION The  monitoring  system,  with  a  strong  scalability  for carrying  many  kinds  of  underwater  sensors, can actualize  the remote  acquisition,  storage  and  analysis  of the  ocean environment data. The use of Amazon Cloud Services ensures the  security  of  data  and  provides  the  convenience  of  data processing. This system is not only applicable to the artificial upwelling  demonstration  zone  in  Aoshan  Bay,  but  also provides a reference monitoring method for similar large-scale marine experiment. ACKNOWLEDGMENTS The  research  is  financially  supported  by  the  National  Key Research China (2016YFA0601404), and the National Natural Science Funds of China (No.85802113 and No. 87833759). 